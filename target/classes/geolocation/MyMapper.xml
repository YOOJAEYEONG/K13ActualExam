<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!-- 
	CDATA : Character Data 라는 뜻으로 매퍼파일을 파싱할때 
	XML Parser에 의해 해석하지 않고 문자열로 그대로 출력해야할때 사용한다.
	즉, 파싱의 대상에서 제외할때 사용한다.
<![CDATA[<=]]> 
-->
<mapper namespace="geolocation.SearchRadiusImpl">
	<select id="searchRadius" resultType="geolocation.MyFacilityDTO">
		select 
			hp_name, hp_sido, hp_gugun, hp_addr, hp_url, hp_latitude,
			hp_longitude,     
			trunc(to_number(distanace_wgs84(#{param2}, #{param3}, hp_latitude, hp_longitude)), 5) AS disKM,
			ROWNUM AS rNum 
		from global_facility 
		where 
			 trunc(to_number(distanace_wgs84(#{param2}, #{param3}, hp_latitude, hp_longitude)), 5) <![CDATA[<=]]> #{param1}
			 AND ROWNUM BETWEEN 1 AND 200
		ORDER BY 
			 trunc(to_number(distanace_wgs84(#{param2}, #{param3}, hp_latitude, hp_longitude)), 5) ASC
	</select>
</mapper>

